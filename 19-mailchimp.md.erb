---
title: Integrating MailChimp
slug: mailchimp
date: 0019/01/01
number: 19
extra: true
points: 1000
published: false
photoUrl: http://www.flickr.com/photos/ikewinski/8377615133/
photoAutor: Mike Lewinski
contents: See what happens behind the scenes when Meteor swaps two DOM elements.|Learn how to animate the reordering of posts.|Learn how to animate the insertion of new posts.
note: NOT INCLUDED IN FREE/TRANSLATED VERSIONS
---

### Mailchimp

~~~js
Package.describe("Mailchimp API library");

Npm.depends({mailchimp: '1.0.3'});

Package.on_use(function (api) {
  api.add_files('mailchimp.js', 'server');
});
~~~
<%= caption "packages/mailchimp/package.js" %>

////

////

~~~js
var MailChimpAPI = Npm.require('mailchimp').MailChimpAPI;

var API_KEY = 'a20d3e317c6bfe0a08088887c71c05cd-us7';
var LIST_ID = '8af64c21ed';

var Future = Npm.require('fibers/future');
var MailChimpAPIObject = new MailChimpAPI(API_KEY, { version : '1.3', secure : false });

MailChimp = {
  listSubscribe: function(options) {
    var future = new Future();
    MailChimpAPIObject.listSubscribe(options, function(err, res) {
      if (err) {
        future.throw(err);
      } else {
        future.return(res);
      }
    });
    
    return future.wait();
  }
}

// XXX: temporary
Meteor.methods({
  subscribe: function(email) {
    MailChimp.listSubscribe({
      id: LIST_ID,
      email_address: email
    });
  }
})
~~~
<%= caption "packages/mailchimp/mailchimp.js" %>

////

### Signing users up to mailchimp when they sign up to Microscope

////

////

////
////

////

~~~js
var MAILCHIMP_LIST_ID = '8af64c21ed';

// sign users up to mailchimp when they are created
Accounts.validateNewUser(function(user) {
  // XXX: what to do here?
  if (! user.emails)
    return;
  
  var email = user.emails[0].address;
  
  MailChimp.listSubscribe({
    id: MAILCHIMP_LIST_ID,
    email_address: email
  });
  
  return user;
});
~~~
<%= caption "server/mailchimp.js" %>

////

<% note do %>

### Asyncro-what?

////

////

////

////
////
////

////

////

<% end %>
