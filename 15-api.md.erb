---
title: RSS Feeds & APIs
slug: rss-api
date: 0015/01/01
number: 15
extra: true
points: 100
published: true
photoUrl: http://www.flickr.com/photos/ikewinski/8623402756/
photoAuthor: Mike Lewinski
contents: Learn about server-side routing.|Create an RSS feed.|Build a simple GET API.
note: NOT INCLUDED IN FREE/TRANSLATED VERSIONS
---

<% note do %>

### Introducing Extra Chapters

////

////

////

<% end %>

////

////

////

////

### Server-Side Routing

////

////

////

////

~~~js
//...

Router.route('/feed.xml', {
  where: 'server',
  name: 'rss',
  action: function() {
    this.response.write('hello world');
    this.response.end();
  }
});

//...
~~~
<%= caption "lib/router.js" %>
<%= highlight "3~10" %>

////

////

~~~js
if (Meteor.isClient){
  Router.onBeforeAction('dataNotFound', {only: 'postPage'});
  Router.onBeforeAction(requireLogin, {only: 'postSubmit'});
}
~~~

////

~~~bash
curl "http://localhost:3000/feed.xml"
hello world
~~~
<%= caption "console" %>

////

////

<%= commit "15-1", "Hello world for server-side routing." %>

### Building The RSS Package From NPM

////

////

////

~~~js
Package.describe({
  name: "rss",
  summary: "RSS feed generator",
  version: '0.1.0'
});

Npm.depends({rss: '1.0.0'});

Package.onUse(function (api) {
  api.versionsFrom('0.9.4');
  api.addFiles('rss.js', 'server');
  api.export('RSS');
});
~~~
<%= caption "packages/rss/package.js" %>

////

////

////

~~~js
RSS = Npm.require('rss');
~~~
<%= caption "packages/rss/rss.js" %>

////

~~~bash
meteor add rss
~~~

<% note do %>

### Local Packages

////

////

<% end %>

### Testing Our Feed

////

~~~js
//...

Router.route('/feed.xml', {
  where: 'server',
  name: 'rss',
  action: function() {
    var feed = new RSS({
      title: "New Microscope Posts",
      description: "The latest posts from Microscope, the smallest news aggregator."
    });
    this.response.write(feed.xml());
    this.response.end();
  }
});

//...
~~~
<%= caption "lib/router.js" %>
<%= highlight "7~11" %>

////

~~~bash
curl "http://localhost:3000/feed.xml"
<?xml version="1.0" encoding="UTF-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[New Microscope Posts]]></title><description><![CDATA[The latest posts from Microscope, the smallest news aggregator.]]></description><link>http://github.com/dylan/node-rss</link><generator>NodeJS RSS Module</generator><lastBuildDate>Tue, 25 Jun 2013 05:21:36 GMT</lastBuildDate></channel></rss>
~~~
<%= caption "console" %>

<%= commit "15-2", "Created RSS package, use it to create a rudimentary feed." %>

### Filling In Our Feed

////

~~~js
//...

Router.route('/feed.xml', {
  where: 'server',
  name: 'rss',
  action: function() {
    var feed = new RSS({
      title: "New Microscope Posts",
      description: "The latest posts from Microscope, the smallest news aggregator."
    });

    Posts.find({}, {sort: {submitted: -1}, limit: 20}).forEach(function(post) {
      feed.item({
        title: post.title,
        description: post.body,
        author: post.author,
        date: post.submitted,
        url: '/posts/' + post._id
      })
    });
      
    this.response.write(feed.xml());
    this.response.end();
  }
});

//...
~~~
<%= caption "lin/router.js" %>
<%= highlight "12~20" %>

<%= commit "15-3", "List each post in the feed." %>

<% note do %>

### RSS Polling

////

////

<% end %>

### Linking Up Our Feed

////

~~~html
<head>
  <title>Microscope</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"/>
</head>
~~~
<%= caption "client/main.html" %>
<%= highlight "3" %>

////

<%= commit "15-4", "Added an RSS link to the site header." %>

### A Simple API

////

////

~~~js
//...

Router.route('/feed.xml', {
  //...
});

Router.route('/api/posts', {
  where: 'server',
  name: 'apiPosts',
  action: function() {
    var data = Posts.find().fetch();
    this.response.write(JSON.stringify(data));
    this.response.end();
  }
});

//...
~~~
<%= caption "lib/router.js" %>
<%= highlight "7~15" %>

////

<%= commit "15-5", "Built a simple /api/posts route." %>

### Dealing With Parameters

////

~~~js
//...

this.route('rss', {
  //...
});

Router.route('/api/posts', {
  where: 'server',
  name: 'apiPosts',
  action: function() {
    var parameters = this.request.query,
        limit = !!parameters.limit ? parseInt(parameters.limit) : 20,
        data = Posts.find({}, {limit: limit, fields: {title: 1, author: 1, url: 1, submitted: 1, }}).fetch();

    this.response.write(JSON.stringify(data));
    this.response.end();
  }
});

//...
~~~
<%= caption "lib/router.js" %>
<%= highlight "7~15" %>

////

////

////

~~~bash
curl http://localhost:3000/api/posts?limit=3
[
{"title":"Introducing Telescope","author":"Sacha Greif","url":"http://sachagreif.com/introducing-telescope/","submitted":1389055069603,"_id":"jBWwNNAhSDSxgaatC"},
{"title":"Meteor","author":"Tom Coleman","url":"http://meteor.com","submitted":1389044269603,"_id":"kYGexqxDpih6uQqN3"},
{"title":"The Meteor Book","author":"Tom Coleman","url":"http://themeteorbook.com","submitted":1389037069603,"_id":"QgJnFFNeyaeyyrQr8"}
]
~~~

<%= commit "15-6", "Limiting the /api/posts route." %>

### The Single Post API

////

~~~js
//...

Router.route('/api/posts', {
  //...
});

Router.route('/api/posts/:_id', {
  where: 'server',
  name: 'apiPost',
  action: function() {
    var post = Posts.findOne(this.params._id);

    if(post){
      this.response.write(JSON.stringify(post));
    } else {
      this.response.writeHead(404, {'Content-Type': 'text/html'});
      this.response.write("Post not found.");
    }
    this.response.end();
  }
});

//...
~~~
<%= caption "lib/router.js" %>
<%= highlight "7~21" %>

////

~~~bash
curl http://localhost:3000/api/posts/kYGexqxDpih6uQqN3d
{"title":"Meteor","userId":"2j3uJ859uT8FdQRz8","author":"Tom Coleman","url":"http://meteor.com","submitted":1389044269603,"commentsCount":0,"upvoters":[],"votes":0,"_id":"kYGexqxDpih6uQqN3"}
~~~

////

~~~bash
$ curl http://localhost:3000/api/posts/1337
Post not found.
~~~

<%= commit "15-7", "Basic route for showing a post." %>

////

